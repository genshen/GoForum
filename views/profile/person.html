<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/img/apple-icon.png">
    <link rel="icon" type="image/png" href="/static/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" />
    <meta name="theme-color" content="#1ba10f">
    <title v-text='person.Name'>正在加载</title>
    <!-- Material Design fonts -->
    <!-- <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">  -->
    <link href="//cdn.bootcss.com/material-design-icons/2.2.3/iconfont/material-icons.css" rel="stylesheet">
     <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="/static/dist/css/material/base.min.css" rel="stylesheet">-->
    <!-- Bootstrap Material Design -->
    <link href="/static/dist/css/bootstrap-material-design.css" rel="stylesheet">
    <link href="/static/dist/css/ripples.min.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet"></head>
<body>
<style>
    .profile-bio {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        word-break: break-all;
        overflow: hidden;
    }

    @media (max-width: 768px) {
        .profile-box {
            text-align: center;
            color: white;
        }

        .profile-bio {
            padding: 0 50px;
        }

        .profile-summary {
            text-align: center;
        }

        .edit-control {
            position: absolute;
            right: 8px;
        }
    }

    @media (max-width: 600px) {
        .profile-bio {
            padding: 0 30px;
        }
    }

    @media (min-width: 768px) {
        .profile-box {
            text-align: left;
            color: white;
        }

        .profile-box .profile-avatar {
            float: left;
            margin-right: 20px;
        }
        .edit-control {
            position: absolute;
            right: 20px;
        }
    }

    .profile-username a, .profile-username a:hover, .profile-username a:active, .profile-username a:visited, .profile-username a:focus {
        color: white
    }

    .profile-avatar img {
        width: 136px;
        height: 136px;
    }

    .follow-action {
        display: inline-block;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        padding: 2px;
        background-color: #0eb400;
        border-radius: 50%;
        color: white;
        position: relative;
        left: -34px;
        top: 40px;
    }

    .follow-action:hover, .follow-action:visited {
        color: white;
    }

    .follow-action:active, .follow-action:focus {
        color: white;
    }
</style>
<main id="app">
    <div class="container-fluid" style="background-color:#4CAF50;padding-top:20px;padding-bottom:15px;">
        <div class="container">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-lg-9 profile-box">
                    <div class="profile-header row">
                        <div v-if="person.Edit" class="btn-group edit-control">
                            <a href="/person/edit" class="btn btn-primary btn-group-sm btn-fab">
                                <i class="material-icons">mode_edit</i>
                            </a>
                        </div>
                        <div class="profile-avatar">
                            <a href="#">
                                <img class="img-circle img-thumbnail" :src="person.Avatar" alt="Avatar">
                            </a>
                            <template v-if="!person.Edit">
                                <a v-if="!person.HasFollowed" @click="addFollow" title="关注" href="javascript:void(0)"
                                   class="follow-action withripple"><i class="material-icons">add</i></a>
                                <a v-else title="取消关注" @click="unFollow" href="javascript:void(0)"
                                   class="follow-action withripple"><i class="material-icons">remove</i></a>
                            </template>
                        </div>
                        <h2 class="profile-username">
                            <a href="#">
                                <span v-text="person.Name">正在加载</span>
                            </a>
                        </h2>
                        <p v-text="'个人简介:'+person.Bio" class="profile-bio">正在加载</p>
                        <p class="profile-join">
                            <span class="glyphicon glyphicon-time"></span>2016年6月15日加入
                        </p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12 profile-summary">
                    <button v-text="person.PostCount+'帖子'" class="btn btn-success btn-raised">正在加载</button>
                    <button v-text="person.FollowedCount+'粉丝'" class="btn btn-success btn-raised">正在加载</button>
                    <button v-text="person.FollowingCount+'关注'" class="btn btn-success btn-raised">正在加载</button>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-xs-3 col-sm-2">积分</div>
                            <div class="col-xs-3 col-sm-2">兑换点</div>
                            <div class="col-xs-3 col-sm-2">代金券</div>
                            <div class="col-xs-3 col-sm-2">兑换中心</div>
                        </div>
                    </div>
                </div>
            </div><!---panel-default-->
        </div>
    </div> <!---/container-fluid--->
    <div class="container">
        <div class="row">
            <div class="panel panel-success">
                <div class="panel-heading">
                    <h3 class="panel-title">最新动态</h3>
                </div>
                <div class="panel-body">
                    <p><i class="material-icons">sentiment_neutral</i>
                        <span style="font-size:16px;vertical-align: super">这人这里空空如也~user id:{{person.Id}}</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</main>
<!-- jQuery -->
<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.js"></script>
<!-- Twitter Bootstrap -->
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<!--<script src="/static/dist/js/material/base.min.js"></script>-->
<!-- Material Design for Bootstrap -->
<script src="/static/dist/js/material.min.js"></script>
<script src="/static/dist/js/ripples.min.js"></script>
<script src="/static/dist/js/vue.js"></script>
<script src="/static/js/util.js"></script>
<script type="text/javascript">
    var SnackBarUnAuth = "请<a href='/account/signin?next=" + document.location.pathname + "'>登录</a>后进行关注";
    var SnackBarError = "出了点错误,请<a href='" + window.location.href + "'>刷新</a>重试";

    $.material.init();
    var person = JSON.parse("<<<.person>>>");
    new Vue({
        el: "html",
        data: {person: person, processing: false},
        ready: function () {
            $.material.ripples('.withripple');
        },
        methods: {
            addFollow: function () {
                if (this.processing) {
                    $.snackbar({content: "操作过于频繁,歇会吧~", timeout: 3000});
                    return;
                }
                if (this.person.IsLogin) {
                    try { //cookie may be null or something else bad data
                        xsrf = base64_decode(Cookies.get('_xsrf').split("|")[0]);
                    } catch (err) {
                        $.snackbar({content: SnackBarError, timeout: 3000});
                        return;
                    }
                    var self = this;
                    this.processing = true;
                    $.ajax({
                        type: 'POST',
                        url: "/profile/follow/add",
                        data: {_xsrf: xsrf, id: this.person.Id},
                        success: function (data) {
                            try {
                                Util.simpleParseError.init(data.Status, data.Error, {
                                    onSuccess: function () {
                                        $.snackbar({content: "关注成功", timeout: 3000});
                                        self.person.HasFollowed = true;
                                    }, errorCallback: function (msg) {
                                        $.snackbar({content: msg, timeout: 3000});
                                    },
                                    onUnAuth: function () {
                                        $.snackbar({content: SnackBarUnAuth, timeout: 3000});
                                    }
                                });
                            } catch (err) {
                                $.snackbar({content: SnackBarError, timeout: 3000});
                            }
                            self.processing = false;
                        },
                        error: function (err) {
                            self.processing = false;
                            $.snackbar({content: SnackBarError, timeout: 3000});
                        }
                    });
                } else {
                    $.snackbar({content: SnackBarUnAuth, timeout: 3000});
                }
            },
            unFollow: function () {
                if (this.processing) {
                    $.snackbar({content: "操作过于频繁,歇会吧~", timeout: 3000});
                    return;
                }
                if (this.person.IsLogin) {
                    $.ajax({
                        type: 'POST',
                        url: "/profile/follow/remove",
                        success:function(data){

                        },error:function(data){

                        }
                    });
                } else {
                    $.snackbar({content: SnackBarUnAuth, timeout: 3000});
                }
            }
        }
    })
</script>
</body>
</html>
